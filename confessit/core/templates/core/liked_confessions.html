{% extends 'core/base.html' %}
{% load static %}

{% block title %}Confessit | Liked Confessions{% endblock %}

{% block content %}
<div class="d-flex flex-wrap justify-content-between align-items-end mb-4">
    <div>
        <h2 class="brand-title">Liked confessions</h2>
        <p class="text-muted mb-0">Stories you have marked with a heart.</p>
    </div>
    <a class="btn btn-sea" href="{% url 'home' %}">Browse more</a>
</div>

<div class="row g-4">
    {% for confession in object_list %}
        <div class="col-md-6 col-lg-4 fade-in">
            <div class="confession-card p-4 h-100" id="liked-card-{{ confession.pk }}">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    {% if confession.user %}
                        <a class="btn btn-outline-dark btn-sm" href="{% url 'profile' confession.user.pk %}">
                            {{ confession.user.username }}
                        </a>
                    {% else %}
                        <span class="confession-meta">Anonymous</span>
                    {% endif %}
                    <div class="d-flex align-items-center gap-2">
                        <div class="confession-meta">{{ confession.created_at|date:"M d, Y" }}</div>
                        <a class="like-btn" href="{% url 'confession_report' confession.pk %}" aria-label="Report confession">
                            <img class="like-icon" src="{% static 'core/icons/flag-unfilled.svg' %}" alt="">
                        </a>
                    </div>
                </div>
                <h5 class="brand-title">{{ confession.title }}</h5>
                <p class="text-muted mt-3">{{ confession.description|truncatechars:160 }}</p>
                <div class="d-flex justify-content-between align-items-center mt-3">
                    <a class="btn btn-link p-0" href="{% url 'confession_detail' confession.pk %}">Read more</a>
                    <div class="d-flex align-items-center gap-2">
                        <a class="like-btn" href="{% url 'confession_detail' confession.pk %}" aria-label="View comments">
                            <svg class="like-icon" viewBox="0 0 24 24" aria-hidden="true">
                                <path d="M20 3H4c-1.1 0-2 .9-2 2v15l4-4h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"/>
                            </svg>
                            <span class="like-count">{{ confession.comments.count }}</span>
                        </a>
                        {% include "core/partials/like_button.html" with confession=confession is_favourited=True hx_target="#liked-card-"|add:confession.pk hx_swap="outerHTML" %}
                    </div>
                </div>
            </div>
        </div>
    {% empty %}
        <div class="col-12">
            <div class="confession-card p-4 text-center">
                <h5 class="brand-title">No liked confessions yet</h5>
                <p class="text-muted">Tap the heart on a confession to save it here.</p>
                <a class="btn btn-sea" href="{% url 'home' %}">Explore confessions</a>
            </div>
        </div>
    {% endfor %}
</div>
{% endblock %}
